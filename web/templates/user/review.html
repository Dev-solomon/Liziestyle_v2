<!-- messages of the review -->
<div class="comment-section" id="review-section">


    <div class="comment-head">
        {% if reviews_pages[0] | int > 0 %}
        <h3><i class="fa fa-comment" aria-hidden="true"></i> Reviews({{reviews_pages[0]}}):</h3>
        {% else %}
        <h3><i class="fa fa-comment" aria-hidden="true"></i> Reviews:</h3>
        {% endif %}
    </div>

    {% if reviews is defined and reviews != [] %}
    {% for review in reviews %}
    <hr />

    <div class="comment-body">
        <h3 class="flex flex-row"><i class="fa fa-user-circle" aria-hidden="true" style="margin-top: 4px;"></i> {{ review['name'] }}
            ({{ review['createdAt'].strftime('%d-%m-%Y') }}) 

            
            {% if review['rating'] | int != 0 %}
            -
            {% for i in range(1, review['rating'] | int + 1) %}
            <svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" width="20" height="20"
                style="shape-rendering:geometricPrecision;text-rendering:geometricPrecision;image-rendering:optimizeQuality;fill-rule:evenodd;clip-rule:evenodd"
                viewBox="0 0 6.827 6.827">
                <path style="fill:#ff8f00;fill-rule:nonzero"
                    d="m3.51 1.252.546 1.536 1.628.043.29.008-.23.176-1.293.993.463 1.563.082.277-.239-.163-1.344-.923-1.343.923-.239.164.082-.278.462-1.564-1.292-.992-.23-.176.29-.008 1.63-.044.544-1.535.097-.274z" />
                <path style="fill:#e68100;fill-rule:nonzero"
                    d="m3.51 1.252.546 1.536 1.628.043.29.008-.23.176-1.293.993.463 1.563.082.277-.239-.163-1.344-.923V.98z" />
                <path style="fill:none" d="M0 0h6.827v6.827H0z" />
            </svg>
            {% endfor %}
            {%else %}
            <span> </span>
            {% endif %}
            
        </h3>
        <div class="comment-message">
            <bold>{{ review['title'] | upper }}:</bold> {{ review['message'] }}
            <div class="comment-images">
                {% if review['images'] is defined and review['images'] != []  %}
                    {% for img in review['images'][:4] %}
                    {% if img != 'Error on uploading file.' %}
                    <img loading="lazy" src="{{ img }}" alt="{{ review['title']}}">
                    {%endif%}
                    {% endfor %}
                {% endif %}
            </div>
        </div>
    </div>
    {% endfor %}
    {% endif %}


    <div class="w-full  mx-auto"
        style="display: flex; flex-direction: row; justify-content: center; gap: 10px; margin: 20px 0;">
        {% if reviews != None and reviews != [] %}
        {% set page_num = request.args.get('page_num', 1) | int %}

        {% if page_num > 1 %}
        <button class="flex-rows gap-3 text-white py-3 px-4 text-xs rounded font-semibold bg-primary-600"
            style="border-radius: 4px; padding: 10px 20px;" onclick="updatePageNumber({{ page_num - 1 }})">Previous</button>
        {% endif %}


        <a href="javascript:void(0);" aria-label="javascript" id="pgN" style="border-radius: 4px; padding: 5px 15px;"
            class="bg-white-600 text-primary-600 border">
            {{page_num}}
        </a>
        <a href="javascript:void(0);" aria-label="javascript" style="padding: 5px;" class="text-secondary-600"> OF </a>
        <a href="javascript:void(0);" aria-label="javascript" style="border-radius: 4px; padding: 5px 15px;"
            class="bg-white-600 text-primary-600 border">
            {{reviews_pages[1]}}
        </a>


        {% if page_num != searched_pages %}
        <button onclick="updatePageNumber_nextButton()"
            class="flex-rows gap-3 text-white py-3 px-4 text-xs rounded font-semibold bg-primary-600"
            style="border-radius: 4px; padding: 10px 20px;">Next</button>
        {% endif %}

        {% endif %}

    </div>

</div>








<!-- review section code -->
<div class="mt-5 review_product">
    <h5 class="font-size-16 mb-3">Leave a review:</h5>
    <hr style="margin-top: 10px;" />

    <form action="/api/products/writereview" method="post" enctype="multipart/form-data">

        <label for="rating">Rating (1 to 5 stars): </label><br>
        
        <div class="stars" id="star-rating">
            <span class="star" data-value="1">★</span>
            <span class="star" data-value="2">★</span>
            <span class="star" data-value="3">★</span>
            <span class="star" data-value="4">★</span>
            <span class="star" data-value="5">★</span>
            <sup style="color: red;">required*</sup>
        </div><br><br>

        <input type="hidden" name="rating" id="rating" value="0" required>

        <div class="row name_email_review flex flex-row justify-between">
            <div class="">
                <div class="mb-3">
                    <label for="commentname-input" class="form-label">Name</label>
                    
                    <input name="name" type="text" class="form-control" id="commentname-input"  value="{% if user is defined %} {{user['fullName']}} {% endif %}" placeholder="User not logged in"
                         disabled>
                        <input name="name" type="text" class="form-control" id="commentname-input"  value="{% if user is defined %} {{user['fullName']}} {% endif %}" placeholder="Enter your name"
                         hidden>
                    
                    
                </div>
            </div>
            <div class="">
                <div class="mb-3">
                    <label for="commentemail-input" class="form-label">Caption</label>
                    <input name="title" type="text" class="form-control" id="commentemail-input"
                        placeholder="Enter the title" required>
                </div>
            </div>
        </div>

        <div class="mb-3 message_review">
            <label for="commentmessage-input" class="form-label">Comment</label>
            <textarea name="message" class="form-control w-full" id="commentmessage-input"
                placeholder="Your message..." required rows="3"></textarea>
        </div>

        <div class="file-input-container">
            <label for="file-upload" class="custom-file-button">
                Upload images
            </label>
            <input type="file" id="file-upload" multiple="multiple" name="images" max="4" />
            <ul id="file-list"></ul>
        </div>


        <input name="product_id" type="hidden" class="form-control" value="{{product['_id']}}">

        <div class="text-end btn_review">
            <button type="submit" class="w-sm">Enter</button>
        </div>
    </form>



    <script type="text/javascript">
        // JavaScript for image modal functionality

// Create the modal structure dynamically
const modal = document.createElement('div');
modal.id = 'imageModal';
modal.style.display = 'none';
modal.style.position = 'fixed';
modal.style.zIndex = '1000';
modal.style.left = '0';
modal.style.top = '0';
modal.style.width = '100%';
modal.style.height = '100%';
modal.style.backgroundColor = 'rgba(0, 0, 0, 0.8)';
modal.style.justifyContent = 'center';
modal.style.alignItems = 'center';
modal.style.cursor = 'pointer';

const modalImage = document.createElement('img');
modalImage.style.maxWidth = '90%';
modalImage.style.maxHeight = '90%';
modal.appendChild(modalImage);

document.body.appendChild(modal);

// Close modal when clicking outside the image
modal.addEventListener('click', () => {
    modal.style.display = 'none';
});

// Add click event listeners to all images in the comment section
const images = document.querySelectorAll('.comment-images img');
images.forEach(image => {
    image.addEventListener('click', () => {
        modalImage.src = image.src; // Set the modal image source to the clicked image
        modal.style.display = 'flex'; // Show the modal
    });
});


const fileInput = document.getElementById('file-upload');
const fileList = document.getElementById('file-list');

fileInput.addEventListener('change', () => {
    // Clear the previous file list
    fileList.innerHTML = '';

    // Loop through the selected files and display their names
    Array.from(fileInput.files).forEach((file) => {
        const listItem = document.createElement('li');
        listItem.textContent = file.name;
        fileList.appendChild(listItem);
    });
});
// Handle the star rating selection
const stars = document.querySelectorAll('.star');
const ratingInput = document.getElementById('rating');

stars.forEach(star => {
    star.addEventListener('click', () => {
        const value = star.getAttribute('data-value');
        ratingInput.value = value;

        // Update the star colors
        stars.forEach(star => {
            star.classList.remove('selected');
        });
        for (let i = 0; i < value; i++) {
            stars[i].classList.add('selected');
        }
    });
});


    </script>